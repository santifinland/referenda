{% extends "base.html" %}

{% load staticfiles %}

{% load avatar_tags %}
{% load i18n %}

{% load account %}
{% load url from future %}

{% block nav %}
<div class="row">
    <div class="small-12 large-12 columns">
        <dl class="sub-nav" style="margin-top: 4px; margin-bottom: 0px">
            <dd class="active"><a href="/"><i class="fi-home"></i> Votaciones</a></dd>
            <dd><a href="/results" style="color: white"><i class="fi-graph-pie"></i> Resultados</a></dd>
            <dd><a href="/delegatevote" style="color: white"><i class="fi-paperclip"></i> Delegar Votos </a></dd>
        </dl>
    </div>
</div>
{% endblock %}

{% block location %}
<div class="row">
    <div class="small-4 large-4 columns">
        <dl class="sub-nav" style="margin-top: 4px; margin-bottom: 0px; margin-left: 30%">
            {% if "Congreso" in request.get_full_path %}
                <dd><a href="/polls/country/Congreso/" style="color: grey"><ins>Congreso</ins></a></dd>
            {% else %}
                <dd><a href="/polls/country/Congreso/" style="color: grey"> Congreso</a></dd>
            {% endif %}
        </dl>
    </div>
    <div class="small-4 large-4 columns">
        <dl class="sub-nav" style="margin-top: 4px; margin-bottom: 0px; margin-left: 10%">
            {% if region %}
                {% if "region" in request.get_full_path %}
                    <dd><a href="/polls/region/{{ region }}/" style="color: grey"><ins> {{ region }} </ins></a></dd>
                {% else %}
                    <dd><a href="/polls/region/{{ region }}/" style="color: grey"> {{ region }} </a></dd>
                {% endif %}
            {% else %}
                {% if "region" in request.get_full_path %}
                    <dd><a href="/polls/region/comunidad_de_madrid/" style="color: grey"><ins> Comunidad de Madrid </ins></a></dd>
                {% else %}
                    <dd><a href="/polls/region/comunidad_de_madrid/" style="color: grey"> Comunidad de Madrid </a></dd>
                {% endif %}
            {% endif %}
        </dl>
    </div>
    <div class="small-4 large-4 columns">
        <dl class="sub-nav" style="margin-top: 4px; margin-bottom: 0px; margin-left: 10%">
            {% if city %}
                {% if "city" in request.get_full_path %}
                  <dd><a href="/polls/city/{{ city }}/" style="color: grey"><ins> {{ city }} </ins></a></dd>
                {% else %}
                    <dd><a href="/polls/city/{{ city }}/" style="color: grey"> {{ city }} </a></dd>
                {% endif %}
            {% else %}
                {% if "city" in request.get_full_path %}
                    <dd><a href="/polls/city/madrid/" style="color: grey"><ins> Madrid</ins></a></dd>
                {% else %}
                    <dd><a href="/polls/city/madrid/" style="color: grey"> Madrid</a></dd>
                {% endif %}
            {% endif %}
        </dl>
    </div>
</div>
{% endblock %}

{% block content %}
<br>
<div class="row">
    {% if poll_list %}

        {% for poll in poll_list %}
            <div class="small-12 large-12 columns">

                <div class="small-6 large-6 columns">
                    <ul class="pricing-table" itemscope itemtype="http://data-vocabulary.org/Event"
                            itemprop="eventType" "VotaciÃ³n">
                        <li class="title" style="text-align: left">
                            <a itemprop="url" href="/referendum/{{ poll.slug }}/">
                                <span itemprop="summary">{{ poll.headline }}</span>
                            </a>
                        </li>
                        <li class="bullet-item" style="text-align: left" itemprop="description">
                            {{ poll.short_description }}
                        </li>
                        <li class="bullet-item" style="text-align: left">
                        <a href={{ poll.link }} target="_blank"> {% trans "Full proposal" %}</a> |
                            <time itemprop="startDate" datetime="{{ poll.vote_date_start.date|date:"Y-m-d"}}T{{ poll.vote_date_start.time|date:"H:i" }}+01:00">
                            </time>
                            <time itemprop="endtDate" datetime="{{ poll.vote_date_end.date|date:"Y-m-d"}}T{{ poll.vote_date_end.time|date:"H:i" }}+01:00">
                            {% trans "Can vote until" %}
                            {{ poll.vote_date_end.date|date:"d" }}
                            {% trans "of" %} {{ poll.vote_date_end.date|date:"F" }}
                            </time>
                        </li>
                    </ul>
                </div>

                <div class="small-2 large-2 columns">
                    <ul class="pricing-table">
                        <li class="title">{% trans "Yes" %}</li>
                        <li class="price">{{ poll.votes_positive }}</li>
                        {% if user.is_authenticated %}
                            <li class="cta-button">
                            <form action="{% url 'vote' poll.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="vote" value="Yes" />
                            {% if poll.vote_date_start < now < poll.vote_date_end %}
                                <input type="submit" class="button" value={% trans "Vote" %} />
                            {% else %}
                                <input type="submit" class="button disabled" value={% trans "Vote" %} />
                            {% endif %}
                            </form>
                            </li>
                        {% else %}
                            <li class="cta-button"><a class="button" href="{% url 'account_login' %}">{% trans "Vote" %}</a></li>
                        {% endif %}
                    </ul>
                </div>

                <div class="small-2 large-2 columns">
                    <ul class="pricing-table">
                        <li class="title small">No</li>
                        <li class="price">{{ poll.votes_negative }}</li>
                        {% if user.is_authenticated %}
                            <li class="cta-button">
                            <form action="{% url 'vote' poll.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="vote" value="No" />
                            {% if poll.vote_date_start < now < poll.vote_date_end %}
                                <input type="submit" class="button" value={% trans "Vote" %} />
                            {% else %}
                                <input type="submit" class="button disabled" value={% trans "Vote" %} />
                            {% endif %}
                            </form>
                            </li>
                        {% else %}
                            <li class="cta-button"><a class="button" href="{% url 'account_login' %}">{% trans "Vote" %}</a></li>
                        {% endif %}
                    </ul>
                </div>
                <div class="small-2 large-2 columns">
                     <ul class="pricing-table">
                         <li class="title small">{% trans "Abstention" %}</li>
                        <li class="price">{{ poll.votes_abstention }}</li>
                        {% if user.is_authenticated %}
                            <li class="cta-button">
                            <form action="{% url 'vote' poll.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="vote" value="Abs" />
                            {% if poll.vote_date_start < now < poll.vote_date_end %}
                                <input type="submit" class="button" value={% trans "Vote" %} />
                            {% else %}
                                <input type="submit" class="button disabled" value={% trans "Vote" %} />
                            {% endif %}
                            </form>
                            </li>
                        {% else %}
                            <li class="cta-button"><a class="button" href="{% url 'account_login' %}">{% trans "Vote" %}</a></li>
                        {% endif %}
                    </ul>
                </div>

            </div>

        {% endfor %}

    {% else %}
      <div class="panel radius">
        <h2>{% trans "This week there are no votings" %}</h2>
      </div>
      <div class="panel radius">
        <h2>{% trans "Please, follow us on" %} <i class="fi-social-twitter style2"></i></h2>
      </div>
      <div class="panel radius">
        <h2>{%trans "We will let you know when votings are available" %}</h2>
      </div>
    {% endif %}
</div>
{% endblock %}
